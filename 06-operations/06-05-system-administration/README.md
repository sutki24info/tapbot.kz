---
title: 06.05 - Системное администрирование
---

**Последнее обновление:** 13 июля 2025\
**Назначение:** Инструменты и процедуры системного администрирования серверов tapbot.kz\
**Область применения:** Управление Linux серверами проекта через различные интерфейсы

## 06\.05.01 - Webmin управление системой

### 06\.05.01.01 - Назначение и роль в проекте

Webmin выполняет роль **вспомогательного инструмента системного администрирования** с акцентом на безопасность и делегирование базовых задач команде.

### 06\.05.01.02 - Целевая аудитория:

-  **Студенты-помощники** с базовыми техническими навыками

-  **Делегирование задач** без предоставления root доступа

-  **Визуальное управление** для команды новичков

### 06\.05.01.03 - Границы использования Webmin:

**✅ ЧТО НУЖНО делать через Webmin:**

-  Мониторинг системных ресурсов (CPU, RAM, диск)

-  Управление системными пользователями Linux

-  Перезапуск системных служб

-  Настройка файрвола Ubuntu (ufw)

-  Просмотр системных логов (/var/log/)

-  Управление файлами через веб-интерфейс

**❌ ЧТО НЕ НУЖНО делать через Webmin:**

-  **PostgreSQL управление** --> используйте pgAdmin (pg.tapbot.kz)

-  **Пользователи Directus** --> используйте интерфейс Directus (dir.tapbot.kz)

-  **Docker контейнеры** --> используйте Portainer (docker1.tapbot.kz)

-  **SSL сертификаты для доменов** --> управляется автоматически через Traefik

### 06\.05.01.04 - Конфигурация серверов

#### Принцип разделения доступа:

```
Первый сервер:  webmin1.tapbot.kz:8441
Второй сервер:  webmin2.tapbot.kz:8442
```

#### Причины смены стандартного порта (10000):

-  **Постоянные атаки ботов** на стандартный порт 10000

-  **90% снижение** количества попыток взлома после смены

-  **Уникальные порты** по серверам для удобства администрирования

### 06\.05.01.05 - Специфичная защита Webmin

#### fail2ban конфигурация:

```bash
# Webmin-специфичные правила (отличаются от общих SSH правил)
[webmin-auth]
enabled = true
port = 8441,8442  # Разные порты на серверах
filter = webmin-auth
logpath = /var/log/auth.log
maxretry = 3
bantime = 7200    # 2 часа (больше чем SSH)
findtime = 300    # 5 минут (меньше чем SSH)
```

#### Ограниченные модули для пользователя monitor:

```
system-status: 1    # Мониторинг системы
proc: 1            # Процессы  
disk-usage: 1      # Использование диска
du: 1              # Размеры директорий
mount: 0           # НЕТ доступа к монтированию
fdisk: 0           # НЕТ доступа к разделам
passwd: 0          # НЕТ доступа к смене паролей
useradmin: 0       # НЕТ доступа к управлению пользователями
```

### 06\.05.01.06 - Интеграция с Docker окружением

#### Мониторинг через Webmin:

-  **Системные ресурсы:** общее потребление контейнерами

-  **Логи системы:** /var/log/syslog включает Docker события

-  **Процессы:** видимость Docker daemon и контейнеров

#### Ограничения Docker управления:

-  **НЕТ прямого управления** контейнерами через Webmin

-  **Используйте Portainer** для Docker-специфичных задач

-  **Webmin только для системного уровня** (процессы, ресурсы)

### 06\.05.01.07 - Типичные сценарии использования

#### Ежедневные административные задачи:

1. Вход в webmin1/webmin2.tapbot.kz:8441/8442

2. System Information --> проверка ресурсов

3. System Logs --> просмотр ошибок за последний час

4. Running Processes --> проверка Docker daemon

5. Disk Usage --> контроль свободного места

#### Реагирование на проблемы:

-  **Высокая загрузка CPU** --> Running Processes --> найти процесс

-  **Мало места на диске** --> Disk Usage --> найти большие файлы

-  **Ошибки в логах** --> System Logs --> анализ типичных проблем

## 06\.05.02 - SSH и удаленный доступ

### 06\.05.02.01 - Базовая SSH конфигурация

#### Стандартные настройки безопасности:

```bash
# /etc/ssh/sshd_config - основные параметры
Port 22
PermitRootLogin yes
PasswordAuthentication yes
PubkeyAuthentication yes
MaxAuthTries 3
ClientAliveInterval 300
ClientAliveCountMax 2
```

### 06\.05.02.02 - Рекомендуемые SSH клиенты:

-  **Windows:** PuTTY, Windows Terminal, MobaXterm

-  **macOS:** встроенный Terminal, iTerm2

-  **Linux:** встроенный ssh клиент

### 06\.05.02.03 - Процедуры безопасного доступа

#### Алгоритм подключения:

1. **Проверить доступность** сервера (ping)

2. **SSH подключение** с использованием ключей (рекомендуется) или паролей

3. **Смена пользователя** при необходимости (su -)

4. **Выполнение задач** в соответствии с правами

5. **Корректное завершение** сессии (exit)

#### Экстренные процедуры доступа:

```bash
# Если основные инструменты недоступны:
1. SSH: ssh root@SERVER_IP
2. Webmin: https://webmin1/2.tapbot.kz:8441/8442
3. Альтернатива: прямой IP https://IP:8441/8442
```

### 06\.05.02.04 - Мониторинг SSH соединений

#### Просмотр активных сессий:

```bash
who          # Текущие пользователи
w            # Подробная информация о сессиях
last         # История входов
netstat -t   # Активные TCP соединения
```

#### Безопасность SSH:

-  **fail2ban защита** от брутфорс атак

-  **Логирование всех действий** в /var/log/auth.log

-  **Автоматическое отключение** неактивных сессий

-  **Блокировка** подозрительных IP

## 06\.05.03 - Пользователи и права доступа

### 06\.05.03.01 - Системные пользователи проекта

#### Основные учетные записи:

```bash
root     - Полные права администратора
monitor  - Ограниченные права мониторинга  
www-data - Веб-сервер (nginx, apache)
postgres - База данных PostgreSQL
```

#### Пользователь monitor (делегированный доступ):

**Назначение:** Безопасное делегирование мониторинговых задач команде без предоставления root прав.

**Разрешенные sudo операции:**

```bash
# Мониторинг служб (только чтение)
monitor ALL=(ALL) NOPASSWD: /bin/systemctl status *
monitor ALL=(ALL) NOPASSWD: /bin/systemctl is-active *
monitor ALL=(ALL) NOPASSWD: /bin/systemctl is-enabled *

# Безопасные службы для перезапуска
monitor ALL=(ALL) NOPASSWD: /bin/systemctl restart fail2ban
monitor ALL=(ALL) NOPASSWD: /bin/systemctl restart rsyslog
monitor ALL=(ALL) NOPASSWD: /bin/systemctl restart cron

# Просмотр логов (только чтение)
monitor ALL=(ALL) NOPASSWD: /usr/bin/tail /var/log/*
monitor ALL=(ALL) NOPASSWD: /usr/bin/head /var/log/*
monitor ALL=(ALL) NOPASSWD: /usr/bin/journalctl *

# Docker мониторинг (только чтение)
monitor ALL=(ALL) NOPASSWD: /usr/bin/docker ps *
monitor ALL=(ALL) NOPASSWD: /usr/bin/docker stats *
monitor ALL=(ALL) NOPASSWD: /usr/bin/docker logs *
```

**ЗАПРЕЩЕННЫЕ операции для monitor:**

-  Остановка/отключение критичных служб

-  Управление Docker контейнерами (start/stop/restart)

-  Перезагрузка/выключение сервера

-  Изменение конфигурационных файлов

### 06\.05.03.02 - Управление правами доступа

#### Принципы минимальных привилегий:

-  **Каждый пользователь** получает только необходимые права

-  **Временные права** предоставляются через sudo

-  **Критические операции** только для root

-  **Аудит действий** через логирование

#### Процедуры создания пользователей:

```bash
# Создание нового пользователя
useradd -m -s /bin/bash username
passwd username

# Добавление в группы
usermod -aG sudo username        # Группа sudo
usermod -aG docker username      # Группа docker (осторожно!)

# Настройка sudo прав
visudo -f /etc/sudoers.d/username
```

### 06\.05.03.03 - Интеграция с Webmin

#### Управление пользователями через Webmin:

-  **Просмотр** существующих пользователей

-  **Мониторинг** активных сессий

-  **Проверка** принадлежности к группам

-  **НЕТ создания/удаления** пользователей (только через SSH)

#### Ограничения Webmin для пользователя monitor:

-  **НЕТ доступа** к модулю управления пользователями

-  **НЕТ прав** на смену паролей

-  **ТОЛЬКО просмотр** системной информации

## 06\.05.04 - Системные утилиты и команды

### 06\.05.04.01 - Базовые утилиты мониторинга

#### Системные ресурсы:

```bash
# Мониторинг процессов
htop         # Интерактивный просмотр процессов
ps aux       # Список всех процессов
pstree       # Дерево процессов

# Использование ресурсов
free -h      # Память
df -h        # Дисковое пространство
du -sh /*    # Размер директорий
lsof         # Открытые файлы

# Сетевая активность
netstat -tlnp    # Прослушиваемые порты
ss -tlnp         # Современная альтернатива netstat
iftop            # Сетевой трафик в реальном времени
```

#### Логи и диагностика:

```bash
# Системные логи
journalctl -f           # Логи systemd в реальном времени
tail -f /var/log/syslog # Системный лог
tail -f /var/log/auth.log # Лог аутентификации

# Docker логи
docker logs container_name
docker stats            # Статистика контейнеров
```

### 06\.05.04.02 - Утилиты обслуживания

#### Управление службами:

```bash
# Systemd команды
systemctl status service_name
systemctl start service_name
systemctl stop service_name
systemctl restart service_name
systemctl enable service_name
systemctl disable service_name

# Просмотр логов служб
journalctl -u service_name
```

#### Дисковые операции:

```bash
# Очистка места
apt autoremove          # Удаление ненужных пакетов
apt autoclean          # Очистка кэша пакетов
docker system prune    # Очистка Docker ресурсов

# Проверка файловой системы
fsck /dev/device       # Проверка файловой системы
badblocks /dev/device  # Проверка на плохие блоки
```

### 06\.05.04.03 - Автоматизация и скрипты

#### Готовые скрипты мониторинга:

```bash
# Скрипт проверки системы (для пользователя monitor)
#!/bin/bash
echo "=== System Health Check ==="
echo "Date: $(date)"
echo "Uptime: $(uptime)"
echo "Memory: $(free -h | grep Mem)"
echo "Disk: $(df -h / | tail -1)"
echo "Docker: $(docker ps --format 'table {{.Names}}\t{{.Status}}')"
```

#### Алиасы для удобства:

```bash
# Добавить в ~/.bashrc для пользователя monitor
alias ll='ls -la'
alias logs='tail -f /var/log/syslog'
alias dockerps='docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"'
alias meminfo='free -h && echo && df -h'
alias sysinfo='uptime && echo && who'
```

### 06\.05.04.04 - Ограничения и безопасность

#### Критические ограничения:

-  **monitor пользователь** не может выполнять потенциально опасные операции

-  **Только чтение** для большинства системных файлов

-  **Запрет редактирования** конфигурационных файлов

-  **Аудит всех действий** через системные логи

#### Интеграция с системой безопасности:

-  **fail2ban мониторинг** через логи

-  **UFW статус** через системные команды

-  **SSL сертификаты** управляются автоматически (Traefik)

-  **Обновления безопасности** только через root доступ

#### Известные ограничения:

-  **Docker контейнеры** могут отображаться некорректно в некоторых утилитах

-  **Сетевые интерфейсы Docker** создают шум в сетевой диагностике

-  **Монтированные volumes** Docker не всегда корректно отображаются

#### Рекомендуемые обходы:

-  **Для Docker мониторинга** --> используйте Portainer

-  **Для детального анализа** --> командная строка + htop

-  **Для сетевой диагностики** --> netstat/ss команды

---

**Примечание:** Все процедуры системного администрирования должны выполняться с учетом принципов минимальных привилегий и под контролем системы аудита. При возникновении проблем всегда есть альтернативные пути доступа через SSH или другие веб-интерфейсы проекта.